#include "synt_analyzer.h"

int synt_analyzer(std::string str)
{
	state states[13][7] = {{{2, 1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 0
						   {{-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {15, -1}},	// 1
						   {{3, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 2
						   {{-1, -1}, {4, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 3
						   {{-1, -1}, {-1, -1}, {5, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 4
						   {{2, 8}, {6, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}},		// 5
						   {{-1, -1}, {-1, -1}, {-1, -1}, {7, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 6
						   {{-1, -1}, {8, -1}, {-1, -1}, {-1, -1}, {8, -1}, {-1, -1}, {-1, -1}},	// 7
						   {{-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {9, -1}, {-2, -2}},	// 8
						   {{2, 12}, {10, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 9
						   {{-1, -1}, {-1, -1}, {-1, -1}, {11, -1}, {-1, -1}, {-1, -1}, {-1, -1}},	// 10
						   {{-1, -1}, {12, -1}, {-1, -1}, {-1, -1}, {12, -1}, {-1, -1}, {-1, -1}},	// 11
						   {{-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-1, -1}, {-2, -2}, {-2, -2}}}; // 12
	std::stack<int> stack;
	int qpre = 0;
	int q = 0;
	int ind = 0;
	while (q != -1 && q != 15)
	{
		qpre = q;
		q = states[q][toktonum(str[ind])].q;
		if (q == 2)
			stack.push(states[qpre][toktonum(str[ind])].S);
		else if (q == -2)
		{
			q = stack.top();
			stack.pop();
		}
		else
			ind++;
	}
	if (q == 15 && ind == str.length())
		return 0;
	return -1;
}

int toktonum(char token)
{
	switch (token)
	{
	case 'f':
		return 0;
		break;
	case 'i':
		return 1;
		break;
	case 't':
		return 2;
		break;
	case 'a':
		return 3;
		break;
	case 'n':
		return 4;
		break;
	case 'e':
		return 5;
		break;
	case ';':
		return 6;
		break;
	default:
		return -1;
		break;
	}
}